<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>gtfsrouter • gtfsrouter</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="gtfsrouter">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gtfsrouter</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/gtfsrouter.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ATFutures/gtfs-router">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>gtfsrouter</h1>
                        <h4 class="author">Mark Padgham</h4>
            
            <h4 class="date">2019-03-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ATFutures/gtfs-router/blob/master/vignettes/gtfsrouter.Rmd"><code>vignettes/gtfsrouter.Rmd</code></a></small>
      <div class="hidden name"><code>gtfsrouter.Rmd</code></div>

    </div>

    
    
<div id="background-gtfs-and-other-r-packages" class="section level1">
<h1 class="hasAnchor">
<a href="#background-gtfs-and-other-r-packages" class="anchor"></a>1 Background: GTFS and other R packages</h1>
<p>GTFS stands for General Transit Feed Specification. It began life in 2005 as the “Google Transit Feed Specification,” which was renamed to “General” in 2009. A GTFS data set consists of several comma-delimited (<code>.csv</code>) files detailing routes, stops, trips, transfers, and other aspects, all bundled in a single <code>.zip</code>-compressed archive file. For full details, see the relevant <a href="https://developers.google.com/transit/gtfs/">google developer site</a>.</p>
<p>There are currently two other <strong>R</strong> packages which handle GTFS data:</p>
<ol style="list-style-type: decimal">
<li>
<a href="https://github.com/ropensci/gtfsr"><code>gtfsr</code></a>, hosted by <a href="https://ropensci.org">rOpenSci</a>, developed by <a href="https://github.com/dantonnoriega">Danton Noriega</a>, but no longer under active development.</li>
<li>
<a href="https://github.com/r-transit/tidytransit"><code>tidytransit</code></a>, which began as a fork of <a href="https://github.com/ropensci/gtfsr"><code>gtfsr</code></a>, and currently represents its successor. This package can be used to, “map transit stops and routes, calculate transit frequencies, and validate transit feeds [as well as to read] the General Transit Feed Specification into tidyverse and simple features dataframes.”</li>
</ol>
<p>The one thing neither of these packages enable is the use of GTFS data for transit routing, which is where the <code>gtfsrouter</code> package comes in. Beyond enabling A-to-B routing, the package also provides various functions for the statistical analysis of GTFS data sets. It does this through converting the full timetable contained in a GTFS data set into a so-called “median timetable” representing the median service frequencies at every stop, and the median travel times between each pair of stops. This vignette is accordingly divided into two major sections: routing and median timetables, respectively describing functions for A-to-B routing, and larger-scale statistical analyses.</p>
<p>Functionality in both cases is demonstrated through the sample data set included with the package, provided by the “Verkehrsverbund Berlin-Brandenburg” (VBB; or Transport Network Berlin-Brandenburg). The <code>berlin_gtfs</code> data represents a reduced version of the full GTFS data, containing only six tables, and a timetable reduced to the single hour between 12:00-13:00. Like all GTFS software including <a href="https://github.com/r-transit/tidytransit"><code>tidytransit</code></a>, this package is designed to work directly with GTFS data in <code>.zip</code>-archived format, and so includes a helper function, <code><a href="../reference/berlin_gtfs_to_zip.html">berlin_gtfs_to_zip()</a></code>, which exports the internal data set to a locally-stored <code>.zip</code> archive in the <code><a href="https://www.rdocumentation.org/packages/base/topics/tempfile">tempdir()</a></code> of the current <strong>R</strong> session. These data can be exported and re-imported with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="../reference/berlin_gtfs_to_zip.html">berlin_gtfs_to_zip</a></span>()</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">f &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span> (<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/tempfile">tempdir</a></span> (), <span class="st">"vbb.zip"</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/files">file.exists</a></span> (f)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">gtfs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/extract_gtfs.html">extract_gtfs</a></span> (f)</a></code></pre></div>
<p>That simply re-creates the original package data, <code>berlin_gtfs</code> (although the extracted data differ through having a couple of additional attributes defining it as a <code>gtfs</code> object).</p>
</div>
<div id="routing" class="section level1">
<h1 class="hasAnchor">
<a href="#routing" class="anchor"></a>2. Routing</h1>
<p>The primary routing function is <code><a href="../reference/gtfs_route.html">gtfs_route()</a></code>, the example of which uses the <code>gtfs</code> data for the VBB created as described above. In simplest form, routing requires a start and end point, defaulting to the current time as desired start time, and routing for the current day of the week.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">from &lt;-<span class="st"> "Innsbrucker Platz"</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">to &lt;-<span class="st"> "Alexanderplatz"</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw"><a href="../reference/gtfs_route.html">gtfs_route</a></span> (gtfs, <span class="dt">from =</span> from, <span class="dt">to =</span> to)</a></code></pre></div>
<pre><code>## Day not specified; extracting timetable for Friday</code></pre>
<table class="table">
<thead><tr class="header">
<th align="left">route_name</th>
<th align="left">trip_name</th>
<th align="left">stop_name</th>
<th align="left">departure_time</th>
<th align="left">arrival_time</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">U4</td>
<td align="left">U Nollendorfplatz</td>
<td align="left">S+U Innsbrucker Platz (Berlin)</td>
<td align="left">12:06:00</td>
<td align="left">12:06:00</td>
</tr>
<tr class="even">
<td align="left">U4</td>
<td align="left">U Nollendorfplatz</td>
<td align="left">U Rathaus Schoneberg (Berlin)</td>
<td align="left">12:07:00</td>
<td align="left">12:07:00</td>
</tr>
<tr class="odd">
<td align="left">U4</td>
<td align="left">U Nollendorfplatz</td>
<td align="left">U Bayerischer Platz (Berlin)</td>
<td align="left">12:08:30</td>
<td align="left">12:08:30</td>
</tr>
<tr class="even">
<td align="left">U4</td>
<td align="left">U Nollendorfplatz</td>
<td align="left">U Viktoria-Luise-Platz (Berlin)</td>
<td align="left">12:10:00</td>
<td align="left">12:10:00</td>
</tr>
<tr class="odd">
<td align="left">U4</td>
<td align="left">U Nollendorfplatz</td>
<td align="left">U Nollendorfplatz (Berlin)</td>
<td align="left">12:12:00</td>
<td align="left">12:12:00</td>
</tr>
<tr class="even">
<td align="left">U2</td>
<td align="left">S+U Pankow</td>
<td align="left">U Nollendorfplatz (Berlin)</td>
<td align="left">12:17:00</td>
<td align="left">12:17:00</td>
</tr>
<tr class="odd">
<td align="left">U2</td>
<td align="left">S+U Pankow</td>
<td align="left">U Bulowstr. (Berlin)</td>
<td align="left">12:18:30</td>
<td align="left">12:18:30</td>
</tr>
<tr class="even">
<td align="left">U2</td>
<td align="left">S+U Pankow</td>
<td align="left">U Gleisdreieck (Berlin)</td>
<td align="left">12:20:30</td>
<td align="left">12:20:30</td>
</tr>
<tr class="odd">
<td align="left">U2</td>
<td align="left">S+U Pankow</td>
<td align="left">U Mendelssohn-Bartholdy-Park (Berlin)</td>
<td align="left">12:22:00</td>
<td align="left">12:22:00</td>
</tr>
<tr class="even">
<td align="left">U2</td>
<td align="left">S+U Pankow</td>
<td align="left">S+U Potsdamer Platz (Bln) [U2]</td>
<td align="left">12:23:30</td>
<td align="left">12:23:30</td>
</tr>
<tr class="odd">
<td align="left">U2</td>
<td align="left">S+U Pankow</td>
<td align="left">U Mohrenstr. (Berlin)</td>
<td align="left">12:25:00</td>
<td align="left">12:25:00</td>
</tr>
<tr class="even">
<td align="left">U2</td>
<td align="left">S+U Pankow</td>
<td align="left">Berlin, U Stadtmitte U2</td>
<td align="left">12:26:00</td>
<td align="left">12:26:00</td>
</tr>
<tr class="odd">
<td align="left">U2</td>
<td align="left">S+U Pankow</td>
<td align="left">U Hausvogteiplatz (Berlin)</td>
<td align="left">12:27:30</td>
<td align="left">12:27:30</td>
</tr>
<tr class="even">
<td align="left">U2</td>
<td align="left">S+U Pankow</td>
<td align="left">U Spittelmarkt (Berlin)</td>
<td align="left">12:29:00</td>
<td align="left">12:29:00</td>
</tr>
<tr class="odd">
<td align="left">U2</td>
<td align="left">S+U Pankow</td>
<td align="left">U Markisches Museum (Berlin)</td>
<td align="left">12:30:00</td>
<td align="left">12:30:00</td>
</tr>
<tr class="even">
<td align="left">U2</td>
<td align="left">S+U Pankow</td>
<td align="left">U Klosterstr. (Berlin)</td>
<td align="left">12:31:30</td>
<td align="left">12:31:30</td>
</tr>
<tr class="odd">
<td align="left">U2</td>
<td align="left">S+U Pankow</td>
<td align="left">S+U Alexanderplatz (Berlin) [U2]</td>
<td align="left">12:33:30</td>
<td align="left">12:33:30</td>
</tr>
</tbody>
</table>
<p>Both the start time and day of the week can be explicitly specified:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">route &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gtfs_route.html">gtfs_route</a></span> (gtfs, <span class="dt">from =</span> from, <span class="dt">to =</span> to, <span class="dt">start_time =</span> <span class="st">"12:00:00"</span>, <span class="dt">day =</span> <span class="st">"Sunday"</span>)</a></code></pre></div>
<div id="gtfs-timetables" class="section level2">
<h2 class="hasAnchor">
<a href="#gtfs-timetables" class="anchor"></a>2.1 GTFS Timetables</h2>
<p>The <code>gtfsrouter</code> package uses the <a href="https://arxiv.org/abs/1703.05997">Connection Scan Algorithm</a>, which requires converting the “stop_times” table to a column-wise timetable. The “stop_times” table has row-wise entries for each distinct “trip_id”, with consecutive rows for a given value of “trip_id” holding sequential values for stops and associated times (and potentially additional variables). In contrast, the timetables processed by this package have separate columns for departure and arrival stations and times. All routing queries pre-process the original GTFS data with the <code><a href="../reference/gtfs_timetable.html">gtfs_timetable()</a></code> function, which appends this timetable data, along with two single-column tables of stop and trip ID values. (The timetable itself contains strictly integer values for stops and trips, which are indices into these latter tables.)</p>
<p>The only important point of that from a user’s perspective is that routing queries will be faster if this pre-processing step is explicitly implemented with <code><a href="../reference/gtfs_timetable.html">gtfs_timetable()</a></code> prior to calling <code><a href="../reference/gtfs_route.html">gtfs_route()</a></code>. This is easy to demonstrate using the sample data:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">gtfs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/extract_gtfs.html">extract_gtfs</a></span> (f)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">from &lt;-<span class="st"> "Innsbrucker Platz"</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">to &lt;-<span class="st"> "Alexanderplatz"</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span> (<span class="kw"><a href="../reference/gtfs_route.html">gtfs_route</a></span> (gtfs, <span class="dt">from =</span> from, <span class="dt">to =</span> to, <span class="dt">start_time =</span> <span class="st">"12:00:00"</span>, <span class="dt">day =</span> <span class="st">"Sunday"</span>))</a></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.168   0.000   0.085</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span> (gtfs)</a></code></pre></div>
<pre><code>## [1] "calendar"   "routes"     "trips"      "stop_times" "stops"     
## [6] "transfers"</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">gtfs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gtfs_timetable.html">gtfs_timetable</a></span> (gtfs, <span class="dt">day =</span> <span class="st">"Sunday"</span>) <span class="co"># explicit pre-processing to extract timetable for Sunday</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span> (gtfs)</a></code></pre></div>
<pre><code>## [1] "calendar"   "routes"     "trips"      "stop_times" "stops"     
## [6] "transfers"  "timetable"  "stop_ids"   "trip_ids"</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span> (<span class="kw"><a href="../reference/gtfs_route.html">gtfs_route</a></span> (gtfs, <span class="dt">from =</span> from, <span class="dt">to =</span> to, <span class="dt">start_time =</span> <span class="st">"12:00:00"</span>))</a></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.132   0.000   0.065</code></pre>
<p>Note that the <code>day</code> parameter is used to extract the timetable, after which it is no longer required in the actual call to <code><a href="../reference/gtfs_route.html">gtfs_route()</a></code>.</p>
</div>
<div id="routing-by-mode-of-transport" class="section level2">
<h2 class="hasAnchor">
<a href="#routing-by-mode-of-transport" class="anchor"></a>2.1. Routing by mode of transport</h2>
<p>It is also possible to filter by desired mode of transport. This is done by matching the pattern to those given in the <code>route_short_name</code> column of the <code>gtfs$route</code> table:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span> (gtfs<span class="op">$</span>route)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">route_id</th>
<th align="right">agency_id</th>
<th align="left">route_short_name</th>
<th align="left">route_long_name</th>
<th align="right">route_type</th>
<th align="left">route_color</th>
<th align="left">route_text_color</th>
<th align="left">route_desc</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">10141_109</td>
<td align="right">1</td>
<td align="left">S1</td>
<td align="left">NA</td>
<td align="right">109</td>
<td align="left">E64DFF</td>
<td align="left">FFFFFF</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">10142_109</td>
<td align="right">1</td>
<td align="left">S1</td>
<td align="left">NA</td>
<td align="right">109</td>
<td align="left">E64DFF</td>
<td align="left">FFFFFF</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">10143_109</td>
<td align="right">1</td>
<td align="left">S2</td>
<td align="left">NA</td>
<td align="right">109</td>
<td align="left">00B300</td>
<td align="left">FFFFFF</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">10144_109</td>
<td align="right">1</td>
<td align="left">S2</td>
<td align="left">NA</td>
<td align="right">109</td>
<td align="left">00B300</td>
<td align="left">FFFFFF</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">10145_109</td>
<td align="right">1</td>
<td align="left">S25</td>
<td align="left">NA</td>
<td align="right">109</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">10148_109</td>
<td align="right">1</td>
<td align="left">S3</td>
<td align="left">NA</td>
<td align="right">109</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>These short names will differ for each GTFS, with the two primary train systems in Berlin being the underground trains denoted “U” (although not always travelling underground), and street-level trains denoted “S”. The default route from Innsbrucker Platz to Alexanderplatz above was via two “U” services. We can also specify that we’d prefer to travel by “S” services, noting that the <code>route_pattern = "S"</code> specifies a <code>route_short_name</code> that <em>starts with</em> (<code>"^"</code>) “S”:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw"><a href="../reference/gtfs_route.html">gtfs_route</a></span> (gtfs, <span class="dt">from =</span> from, <span class="dt">to =</span> to, <span class="dt">start_time =</span> <span class="st">"12:00:00"</span>, <span class="dt">day =</span> <span class="st">"Sunday"</span>, <span class="dt">route_pattern =</span> <span class="st">"^S"</span>)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">route_name</th>
<th align="left">trip_name</th>
<th align="left">stop_name</th>
<th align="left">departure_time</th>
<th align="left">arrival_time</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">S42</td>
<td align="left">S Sudkreuz Bhf</td>
<td align="left">S+U Innsbrucker Platz (Berlin)</td>
<td align="left">12:07:12</td>
<td align="left">12:06:42</td>
</tr>
<tr class="even">
<td align="left">S42</td>
<td align="left">S Sudkreuz Bhf</td>
<td align="left">S Schoneberg (Berlin)</td>
<td align="left">12:08:48</td>
<td align="left">12:08:18</td>
</tr>
<tr class="odd">
<td align="left">S42</td>
<td align="left">S Sudkreuz Bhf</td>
<td align="left">S Sudkreuz Bhf (Berlin)</td>
<td align="left">12:10:12</td>
<td align="left">12:10:12</td>
</tr>
<tr class="even">
<td align="left">S2</td>
<td align="left">S Buch</td>
<td align="left">S Sudkreuz Bhf (Berlin)</td>
<td align="left">12:16:54</td>
<td align="left">12:16:18</td>
</tr>
<tr class="odd">
<td align="left">S2</td>
<td align="left">S Buch</td>
<td align="left">S+U Yorckstr. S2 S25 S26 U7 (Berlin)</td>
<td align="left">12:19:30</td>
<td align="left">12:19:00</td>
</tr>
<tr class="even">
<td align="left">S2</td>
<td align="left">S Buch</td>
<td align="left">S Anhalter Bahnhof (Berlin)</td>
<td align="left">12:22:12</td>
<td align="left">12:21:42</td>
</tr>
<tr class="odd">
<td align="left">S2</td>
<td align="left">S Buch</td>
<td align="left">S+U Potsdamer Platz Bhf (Berlin)</td>
<td align="left">12:24:18</td>
<td align="left">12:23:48</td>
</tr>
<tr class="even">
<td align="left">S2</td>
<td align="left">S Buch</td>
<td align="left">S+U Brandenburger Tor (Berlin)</td>
<td align="left">12:26:24</td>
<td align="left">12:25:54</td>
</tr>
<tr class="odd">
<td align="left">S2</td>
<td align="left">S Buch</td>
<td align="left">S+U Friedrichstr. Bhf (Berlin)</td>
<td align="left">12:28:24</td>
<td align="left">12:27:36</td>
</tr>
<tr class="even">
<td align="left">S7</td>
<td align="left">S Ahrensfelde Bhf</td>
<td align="left">S+U Friedrichstr. Bhf (Berlin)</td>
<td align="left">12:31:24</td>
<td align="left">12:30:36</td>
</tr>
<tr class="odd">
<td align="left">S7</td>
<td align="left">S Ahrensfelde Bhf</td>
<td align="left">S Hackescher Markt (Berlin)</td>
<td align="left">12:33:24</td>
<td align="left">12:32:54</td>
</tr>
<tr class="even">
<td align="left">S7</td>
<td align="left">S Ahrensfelde Bhf</td>
<td align="left">S+U Alexanderplatz Bhf (Berlin)</td>
<td align="left">12:35:24</td>
<td align="left">12:34:36</td>
</tr>
</tbody>
</table>
</div>
<div id="routing-for-earliest-arrivals-or-earliest-departures" class="section level2">
<h2 class="hasAnchor">
<a href="#routing-for-earliest-arrivals-or-earliest-departures" class="anchor"></a>2.2. Routing for earliest arrivals or earliest departures</h2>
<p>The above route with the “S” services leaves one minute later, and arrives two minutes later. Importantly, <code><a href="../reference/gtfs_route.html">gtfs_route()</a></code> searches by default for the service which arrives at the nominated destination station at the earliest time. This may not always be the first available service departing from the nominated start station. Routing with the earliest <em>departing</em> service, instead of the earliest <em>arriving</em> service, can be specified with the binary <code>earliest_arrival</code> parameter:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">from &lt;-<span class="st"> "Alexanderplatz"</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2">to &lt;-<span class="st"> "Pankow"</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="kw"><a href="../reference/gtfs_route.html">gtfs_route</a></span> (gtfs, <span class="dt">from =</span> from, <span class="dt">to =</span> to, <span class="dt">start_time =</span> <span class="st">"12:00:00"</span>, <span class="dt">day =</span> <span class="st">"Sunday"</span>, <span class="dt">earliest_arrival =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">route_name</th>
<th align="left">trip_name</th>
<th align="left">stop_name</th>
<th align="left">departure_time</th>
<th align="left">arrival_time</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">S7</td>
<td align="left">S Potsdam Hauptbahnhof</td>
<td align="left">S+U Alexanderplatz Bhf (Berlin)</td>
<td align="left">12:00:42</td>
<td align="left">11:59:54</td>
</tr>
<tr class="even">
<td align="left">S7</td>
<td align="left">S Potsdam Hauptbahnhof</td>
<td align="left">S Hackescher Markt (Berlin)</td>
<td align="left">12:02:24</td>
<td align="left">12:01:54</td>
</tr>
<tr class="odd">
<td align="left">S7</td>
<td align="left">S Potsdam Hauptbahnhof</td>
<td align="left">S+U Friedrichstr. Bhf (Berlin)</td>
<td align="left">12:04:42</td>
<td align="left">12:03:54</td>
</tr>
<tr class="even">
<td align="left">S2</td>
<td align="left">S Buch</td>
<td align="left">S+U Friedrichstr. Bhf (Berlin)</td>
<td align="left">12:08:24</td>
<td align="left">12:07:36</td>
</tr>
<tr class="odd">
<td align="left">S2</td>
<td align="left">S Buch</td>
<td align="left">S Oranienburger Str. (Berlin)</td>
<td align="left">12:10:12</td>
<td align="left">12:09:42</td>
</tr>
<tr class="even">
<td align="left">S2</td>
<td align="left">S Buch</td>
<td align="left">S Nordbahnhof (Berlin)</td>
<td align="left">12:12:12</td>
<td align="left">12:11:42</td>
</tr>
<tr class="odd">
<td align="left">S2</td>
<td align="left">S Buch</td>
<td align="left">S Humboldthain (Berlin)</td>
<td align="left">12:14:54</td>
<td align="left">12:14:24</td>
</tr>
<tr class="even">
<td align="left">S2</td>
<td align="left">S Buch</td>
<td align="left">S+U Gesundbrunnen Bhf (Berlin)</td>
<td align="left">12:16:54</td>
<td align="left">12:16:12</td>
</tr>
<tr class="odd">
<td align="left">S2</td>
<td align="left">S Buch</td>
<td align="left">S Bornholmer Str. (Berlin)</td>
<td align="left">12:18:54</td>
<td align="left">12:18:24</td>
</tr>
<tr class="even">
<td align="left">S2</td>
<td align="left">S Buch</td>
<td align="left">S+U Pankow (Berlin)</td>
<td align="left">12:21:18</td>
<td align="left">12:20:42</td>
</tr>
</tbody>
</table>
<p>And the earliest-departing route arrives at Pankow at 12:14:24, departing Alexanderplatz at 12:00:42. In contrast, the earliest-arriving service is:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw"><a href="../reference/gtfs_route.html">gtfs_route</a></span> (gtfs, <span class="dt">from =</span> from, <span class="dt">to =</span> to, <span class="dt">start_time =</span> <span class="st">"12:00:00"</span>, <span class="dt">day =</span> <span class="st">"Sunday"</span>, <span class="dt">earliest_arrival =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">route_name</th>
<th align="left">trip_name</th>
<th align="left">stop_name</th>
<th align="left">departure_time</th>
<th align="left">arrival_time</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">U2</td>
<td align="left">S+U Pankow</td>
<td align="left">S+U Alexanderplatz (Berlin) [U2]</td>
<td align="left">12:09:00</td>
<td align="left">12:09:00</td>
</tr>
<tr class="even">
<td align="left">U2</td>
<td align="left">S+U Pankow</td>
<td align="left">U Rosa-Luxemburg-Platz (Berlin)</td>
<td align="left">12:11:00</td>
<td align="left">12:11:00</td>
</tr>
<tr class="odd">
<td align="left">U2</td>
<td align="left">S+U Pankow</td>
<td align="left">U Senefelderplatz (Berlin)</td>
<td align="left">12:12:30</td>
<td align="left">12:12:30</td>
</tr>
<tr class="even">
<td align="left">U2</td>
<td align="left">S+U Pankow</td>
<td align="left">U Eberswalder Str. (Berlin)</td>
<td align="left">12:14:30</td>
<td align="left">12:14:30</td>
</tr>
<tr class="odd">
<td align="left">U2</td>
<td align="left">S+U Pankow</td>
<td align="left">S+U Schonhauser Allee (Berlin)</td>
<td align="left">12:16:30</td>
<td align="left">12:16:30</td>
</tr>
<tr class="even">
<td align="left">U2</td>
<td align="left">S+U Pankow</td>
<td align="left">U Vinetastr. (Berlin)</td>
<td align="left">12:19:00</td>
<td align="left">12:19:00</td>
</tr>
<tr class="odd">
<td align="left">U2</td>
<td align="left">S+U Pankow</td>
<td align="left">S+U Pankow (Berlin)</td>
<td align="left">12:20:30</td>
<td align="left">12:20:30</td>
</tr>
</tbody>
</table>
<p>The service departs at 12:09:00, and arrives at 12:20:30. Importantly, queries for earliest-arriving services require two full routing runs, whereas earliest-departing services can be executed in a single run. This, bulk queries for analytic purposes will generally be up to twice as first with <code>earliest_arrival = FALSE</code>.</p>
</div>
</div>
<div id="median-timetables" class="section level1">
<h1 class="hasAnchor">
<a href="#median-timetables" class="anchor"></a>3. Median Timetables</h1>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#background-gtfs-and-other-r-packages">1 Background: GTFS and other R packages</a></li>
      <li>
<a href="#routing">2. Routing</a><ul class="nav nav-pills nav-stacked">
<li><a href="#gtfs-timetables">2.1 GTFS Timetables</a></li>
      <li><a href="#routing-by-mode-of-transport">2.1. Routing by mode of transport</a></li>
      <li><a href="#routing-for-earliest-arrivals-or-earliest-departures">2.2. Routing for earliest arrivals or earliest departures</a></li>
      </ul>
</li>
      <li><a href="#median-timetables">3. Median Timetables</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Mark Padgham.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
