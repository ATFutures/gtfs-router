[![Build Status](https://travis-ci.org/ATFutures/gtfs-router.svg)](https://travis-ci.org/ATFutures/gtfs-router) 
[![AppVeyor Build Status](https://ci.appveyor.com/api/projects/status/github/ATFutures/gtfs-router?branch=master&svg=true)](https://ci.appveyor.com/project/ATFutures/gtfs-router)
[![codecov](https://codecov.io/gh/ATFutures/gtfs-router/branch/master/graph/badge.svg)](https://codecov.io/gh/ATFutures/gtfs-router)
[![Project Status: WIP](https://www.repostatus.org/badges/latest/wip.svg)](https://www.repostatus.org/#wip)



# GTFS Router

**R** package for routing with [GTFS (General Transit Feed
Specification)](https://developers.google.com/transit/gtfs/) data. Among the
additional aims of this repo are to quantify the dynamic stability of a GTFS
network in time and space, and to identify "weakest nodes" as those where a
temporal disruption propogates out to have the greatest effect throughout the
broader network.

Test data will be the VBB (Verkehrsverbund Berlin-Brandenburg) GTFS feed
available [here](https://daten.berlin.de/datensaetze/vbb-fahrplandaten-gtfs),
with the results providing useful input data for
[`flux.fail`](https://flux.fail).

## Installation

To install:
```{r remotes, eval=FALSE}
remotes::install_github("atfutures/gtfs-router")
```
```{r load_all, echo = FALSE, message = FALSE}
devtools::load_all (".", export_all = FALSE)
```


To load the package and check the version:
```{r pkg-version, eval=TRUE}
library(gtfsrouter)
packageVersion("gtfsrouter")
```

## Example

The package contains some sample data from Berlin (the Verkehrverbund Berlin
Brandenburg, or VBB). These data can be stored in a local `.zip` file with the
following commands:
Download the VBB data from the above link in a local directory, load the
package:
Then:
```{r example, eval = TRUE}
gtfs <- extract_gtfs (list.files () [grep ("VBB", list.files ())])
gtfs <- gtfs_timetable (gtfs) # A pre-processing step to speed up queries
st <- system.time (
             r <- gtfs_route (gtfs,
                              from = "SchÃ¶nlein",
                              to = "Berlin Hauptbahnhof",
                              start_time = 14 * 3600) # 14:00 in seconds
)
st
knitr::kable (r)
```

And a routing query on a very large network (the GTFS data are
`r round(file.size(list.files()[grep("VBB",list.files())]) / 1e6)` MB) takes only 
`r round (st[3] * 100) / 100` seconds.



## GTFS Structure

For background information, see [`gtfs.org`](http://gtfs.org), and particularly
their [GTFS
Examples](https://docs.google.com/document/d/16inL5BVcM1aU-_DcFJay_tC6Ni0wPa0nvQEstueG5k4/edit).
The VBB is strictly schedule-only, so has no `"frequencies.txt"` file (this file
defines "service periods", and overrides any schedule information during the
specified times).

