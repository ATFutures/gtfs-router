---
title: "Travel Times"
author: "Alexandra Kapp"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    number_sections: false
    theme: flatly
vignette: >
  %\VignetteIndexEntry{Travel Times}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
  
  
```{r pkg-load, echo = FALSE, message = FALSE}
library (gtfsrouter)
#devtools::load_all (".", export_all = FALSE)
```

# Traveltimes

Building on the idea if isochrones the function
[`gtfs_traveltimes()`](https://atfutures.github.io/gtfs-router/reference/gtfs_isochrone.html)
calculates travel times from a nominated start station to all other stations.
The travel time for a route is selected which has the shortest duration for the
minimum possible transfers. The function returns a data frame, each row
representing a destination station with information about amount of transfers,
start time and duration needed from the start station. As with routing, the
function also requires initial extraction of GTFS data and, for faster queries,
explicit conversion to
[`gtfs_timetable()`](https://atfutures.github.io/gtfs-router/reference/gtfs_timetable.html)
format.

```{r berlin_gtfs}
berlin_gtfs_to_zip ()
f <- file.path (tempdir (), "vbb.zip")
gtfs <- extract_gtfs (f)
gtfs <- gtfs_timetable (gtfs, day = 3)
```
The parameter `start_time_limits` sets the earliest and latest possible start
for desired route travel times. E.g. to get travel times for routes starting
between 12 PM and 1 PM the limits should be set as `start_time_limits =
c(12*3600, 13*3600)`.

```{r traveltimes}
from <- "Alexanderplatz"
start_time_limits <- c(12*3600, 13*3600)
tt1 <- gtfs_traveltimes(gtfs,
                      from = from,
                      start_time_limits = start_time_limits)
head(tt1)
```

With the parameter `max_traveltime` the maximum travel time can be specified
(in seconds). By default it is set to one hour. So the previous query included
trips up to one hour travel time:

```{r max traveltime1}
head(data.table::setorder(tt1,-"duration"), 3)
```

To get trips for the same start point but only up to 30 minutes travel time,
set the `max_traveltime` parameter accordingly:

```{r max_traveltime2}
max_traveltime <- 30*60 # half hour
tt2 <- gtfs_traveltimes(gtfs,
                      from = from,
                      start_time_limits = start_time_limits,
                      max_traveltime = max_traveltime)
head(data.table::setorder(tt2,-"duration"), 3)
```
