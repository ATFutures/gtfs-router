---
title: "gtfsrouter travel times"
author: "Mark Padgham"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    number_sections: false
    theme: flatly
vignette: >
  %\VignetteIndexEntry{gtfsrouter_traveltime}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
  
  
```{r pkg-load, echo = FALSE, message = FALSE}
library (gtfsrouter)
#devtools::load_all (".", export_all = FALSE)
```

# Traveltimes

Building on the idea if isochrones the function [`gtfs_traveltimes()`](https://atfutures.github.io/gtfs-router/reference/gtfs_isochrone.html) calculates travel times from a nominated start station to all other stations. The travel time for a route is selected that has the shortest duration for the minimum possible transfers. 
The function returns a data frame, each row representing a destination station with information about amount of transfers, start time and duration needed from the start station.
As with routing, the
function also requires initial extraction of GTFS data and, for faster queries,
explicit conversion to
[`gtfs_timetable()`](https://atfutures.github.io/gtfs-router/reference/gtfs_timetable.html)
format.

```{r berlin_gtfs}
berlin_gtfs_to_zip ()
f <- file.path (tempdir (), "vbb.zip")
gtfs <- extract_gtfs (f)
gtfs <- gtfs_timetable (gtfs, day = 3)
```

```{r traveltimes}
from <- "Alexanderplatz"
start_time <- "12:00"
tt <- gtfs_traveltimes(gtfs,
                      from = from,
                      start_time = start_time)
head(tt)
```
With the parameter `prop_stops` the proportion of stops, that a travel time shall be returned for, can be specified. Some stops may only be reached very infrequently (like once per day), and scanning a timetable until all stops have been reached may (1) yield anomalously long travel times for very infrequently serviced stops; and (2) take a long time to calculate. The `prop_stops` parameter should accordingly generally be less than 1. For large systems with many stops (tens of thousands), values of 0.5 are often sufficient to reach most of the system. 
